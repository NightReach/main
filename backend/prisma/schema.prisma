datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      String // ‚Üê FIXED (was enum)
  createdAt DateTime @default(now())

  websites  Website[]
  campaigns Campaign[]
}

model Website {
  id              String   @id @default(cuid())
  domain          String
  reviveWebsiteId Int
  userId          String
  createdAt       DateTime @default(now())

  user  User    @relation(fields: [userId], references: [id]) // ‚úÖ FIX
  zones Zone[] // ‚úÖ opposite of Zone.website
  Click Click[]
}

model Zone {
  id           String   @id @default(cuid())
  websiteId    String
  reviveZoneId Int
  width        Int
  height       Int
  createdAt    DateTime @default(now())

  website       Website        @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  campaignZones CampaignZone[]
  Click         Click[]

  @@index([websiteId])
}

model Campaign {
  id     String @id @default(cuid())
  userId String

  name   String
  status String @default("ACTIVE") // ACTIVE | PAUSED

  reviveCampaignId Int

  payoutType  String // CPC | CPA | CPM
  payoutValue Float

  createdAt DateTime @default(now())

  user          User           @relation(fields: [userId], references: [id])
  campaignZones CampaignZone[]
  Click         Click[]
  Conversion    Conversion[]
}

model CampaignZone {
  id         String @id @default(cuid())
  campaignId String
  zoneId     String

  campaign Campaign @relation(fields: [campaignId], references: [id])
  zone     Zone     @relation(fields: [zoneId], references: [id])

  @@unique([campaignId, zoneId])
}

model Click {
  id         String   @id @default(cuid())
  campaignId String
  zoneId     String
  websiteId  String
  ip         String
  userAgent  String
  referer    String?
  createdAt  DateTime @default(now())

  conversions Conversion[]
  campaign    Campaign     @relation(fields: [campaignId], references: [id])
  zone        Zone         @relation(fields: [zoneId], references: [id])
  website     Website      @relation(fields: [websiteId], references: [id])
}

model Conversion {
  id         String   @id @default(cuid())
  campaignId String
  clickId    String   @unique
  payout     Float
  createdAt  DateTime @default(now())

  // üîó REQUIRED opposite relation
  click    Click    @relation(fields: [clickId], references: [id])
  campaign Campaign @relation(fields: [campaignId], references: [id])
}

model DailyStat {
  id   String   @id @default(cuid())
  date DateTime

  userId     String
  campaignId String?
  zoneId     String?

  clicks      Int   @default(0)
  conversions Int   @default(0)
  revenue     Float @default(0)

  createdAt DateTime @default(now())

  @@unique([date, userId, campaignId, zoneId])
  @@index([userId, date])
}
